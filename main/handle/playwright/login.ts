import { Browser, BrowserContext, BrowserType, Page, chromium, devices } from 'playwright';
import { ipcMain } from 'electron';
import { playwrightEnum, handleKeys } from '../handleMap';

const titokConfig: LoginConfig = {
  loginUrl: 'https://creator.douyin.com/',
  waitForUrl: '**/home',
};

ipcMain.handle(playwrightEnum.login, async (evt, plationType: string) => {
  console.log({ evt, plationType });
  let info: UserInfo;
  let handler: ReturnType<typeof useLogin>;
  switch (plationType) {
    case 'titok':
      handler = useLogin(titokConfig);
      info = await handler.exec();
      break;
    default:
      console.log('暂不支持该平台');
      return new Error('暂不支持该平台');
  }

  return info;
});

interface LoginConfig {
  loginUrl: string;
  waitForUrl: string;
  [key: string]: any;
}

export interface UserInfo {
  storageState: string;
  name: string;
  accountId: string | number;
  fans?: number;
  status: 0 | 1;
}

function useLogin(config: LoginConfig) {
  let browser: Browser;
  let context: BrowserContext;
  let page: Page;
  let userInfo: UserInfo = {
    status: 0,
    storageState:
      '{"cookies":[{"name":"x-jupiter-uuid","value":"17194066196892364","domain":"creator.douyin.com","path":"/goofy/douyin_creator_pc/creator_pc_vmok_common","expires":1720011420.066864,"httpOnly":true,"secure":false,"sameSite":"Lax"},{"name":"msToken","value":"CTn20q0MqVSa3YNmscj_a7fZILXTczEQsHkQAtpD3gv808mZT8zWZOwaATko6Oy4o4V0tHjGm5r5rTU60T1B1qTMxfv1rjbJpWf0xUHG","domain":".douyin.com","path":"/","expires":1720011420.003636,"httpOnly":false,"secure":true,"sameSite":"None"},{"name":"ttwid","value":"1%7C0dQi3yoLTMpzJlgyYvsKSAaR41tZdQzLb9SyMu0PjDg%7C1719406620%7C9a817d4dd06131b1d4a9aa9ee463314dadd017d7ca214a0d48c6a979fff05beb","domain":".bytedance.com","path":"/","expires":1750942620.647274,"httpOnly":true,"secure":true,"sameSite":"None"},{"name":"ttwid","value":"1%7C0dQi3yoLTMpzJlgyYvsKSAaR41tZdQzLb9SyMu0PjDg%7C1719406620%7C9a817d4dd06131b1d4a9aa9ee463314dadd017d7ca214a0d48c6a979fff05beb","domain":".douyin.com","path":"/","expires":1750942620.74623,"httpOnly":true,"secure":true,"sameSite":"None"},{"name":"bd_ticket_guard_client_data","value":"eyJiZC10aWNrZXQtZ3VhcmQtdmVyc2lvbiI6MiwiYmQtdGlja2V0LWd1YXJkLWl0ZXJhdGlvbi12ZXJzaW9uIjoxLCJiZC10aWNrZXQtZ3VhcmQtcmVlLXB1YmxpYy1rZXkiOiJCRzJsZVNmak85aGxJYkRLMDNEMGJJV0lNbkF3bU8zSC9aOEhvTWhWV1plVTVVSmNzT0JlT0lmU3pKSXNIM0hpQnhmYmFaeCtHUHp5dG5LdUhOYVd5WE09IiwiYmQtdGlja2V0LWd1YXJkLXdlYi12ZXJzaW9uIjoxfQ%3D%3D","domain":".douyin.com","path":"/","expires":1724590621.675202,"httpOnly":false,"secure":false,"sameSite":"Lax"},{"name":"bd_ticket_guard_client_web_domain","value":"2","domain":".douyin.com","path":"/","expires":1724590621.675382,"httpOnly":false,"secure":false,"sameSite":"Lax"},{"name":"passport_csrf_token","value":"5826e61ca0daea75ae872ce9b6a59100","domain":".douyin.com","path":"/","expires":1724590622.020049,"httpOnly":false,"secure":true,"sameSite":"None"},{"name":"passport_csrf_token_default","value":"5826e61ca0daea75ae872ce9b6a59100","domain":".douyin.com","path":"/","expires":1724590622.020156,"httpOnly":false,"secure":false,"sameSite":"Lax"},{"name":"msToken","value":"ksH8DlAXGYvfzIwlkgLchLMWqIGW-km_6SiEgmGXI6SudMt6QKglPe_362XQEwYjDCCilPM1mliVZ20lhY43Q0XzutOXLejBXhTUh4uVvQguue1sRRQenaDGgZRD","domain":"creator.douyin.com","path":"/","expires":1750942622,"httpOnly":false,"secure":false,"sameSite":"Lax"},{"name":"ttcid","value":"6b4834cf267f4c399ca0085a3ed4d15330","domain":"creator.douyin.com","path":"/","expires":1750942628,"httpOnly":false,"secure":false,"sameSite":"Lax"},{"name":"ttcid","value":"6b4834cf267f4c399ca0085a3ed4d15330","domain":"xxbg.snssdk.com","path":"/","expires":1720011429.692679,"httpOnly":true,"secure":true,"sameSite":"None"},{"name":"tt_scid","value":"MtgjOZM18Q1elRQT0Xd0cRiRgopurcRJEpIlX0-PF9EvcrO5fHn148exeBcxyYv1d08b","domain":"xxbg.snssdk.com","path":"/","expires":1720011429.692836,"httpOnly":true,"secure":true,"sameSite":"None"},{"name":"tt_scid","value":"MtgjOZM18Q1elRQT0Xd0cRiRgopurcRJEpIlX0-PF9EvcrO5fHn148exeBcxyYv1d08b","domain":"creator.douyin.com","path":"/","expires":1750942629,"httpOnly":false,"secure":false,"sameSite":"Lax"},{"name":"d_ticket","value":"e3215194e299ae044dc3dcbd8f3543cf57eb0","domain":".douyin.com","path":"/","expires":1750942765.779338,"httpOnly":true,"secure":false,"sameSite":"Lax"},{"name":"s_v_web_id","value":"verify_lxvue7co_kVAIeQZE_YgAf_4CzN_8LHV_6spzTMIiA14d","domain":"creator.douyin.com","path":"/","expires":1724590765,"httpOnly":false,"secure":false,"sameSite":"Lax"},{"name":"passport_assist_user","value":"CkHK6r3uwNxyEAm27QJLLJtf1Adw265pAEKYO9hC1tDpqMNnSvMPfk0iv1ScBTQEPdSk8u0zYgSWVbWvsUJbrREULBpKCjwURTkuJy440_HarMwmbe24qm0Z1KzB5uwp1b4SMemoocb0KgEy9kj4qCv1GTGwdp98prZw01dlwCgC14kQvYfVDRiJr9ZUIAEiAQOYKa-g","domain":".douyin.com","path":"/","expires":1753966767.136553,"httpOnly":false,"secure":true,"sameSite":"Lax"},{"name":"n_mh","value":"9jvyGjMC4sjmzHvAtNW7AQlqAAPjbiWfbR7bH_90JOE","domain":".douyin.com","path":"/","expires":1729774767.136583,"httpOnly":true,"secure":false,"sameSite":"Lax"},{"name":"sso_auth_status","value":"77f6e56aaa27a53b6cae8d5ba9bca34c","domain":".douyin.com","path":"/","expires":1721998767.136649,"httpOnly":true,"secure":false,"sameSite":"Lax"},{"name":"sso_auth_status_ss","value":"77f6e56aaa27a53b6cae8d5ba9bca34c","domain":".douyin.com","path":"/","expires":1721998767.136668,"httpOnly":true,"secure":true,"sameSite":"None"},{"name":"sso_uid_tt","value":"25e7713a5b25df491a12f1d28284b8bb","domain":".douyin.com","path":"/","expires":1724590767.136688,"httpOnly":true,"secure":true,"sameSite":"Lax"},{"name":"sso_uid_tt_ss","value":"25e7713a5b25df491a12f1d28284b8bb","domain":".douyin.com","path":"/","expires":1724590767.136707,"httpOnly":true,"secure":true,"sameSite":"None"},{"name":"toutiao_sso_user","value":"4376ebd09834a6994778eb2c7094d3f1","domain":".douyin.com","path":"/","expires":1724590767.136737,"httpOnly":true,"secure":true,"sameSite":"Lax"},{"name":"toutiao_sso_user_ss","value":"4376ebd09834a6994778eb2c7094d3f1","domain":".douyin.com","path":"/","expires":1724590767.136759,"httpOnly":true,"secure":true,"sameSite":"None"},{"name":"sid_ucp_sso_v1","value":"1.0.0-KDNjMzZkZTVlZmE5MDc0NzZmZmM0ZjhjMDNlMmNmNTdhNjcxMTgwNmEKIQjDoeChnsyCAxCuofCzBhjaFiAMMMGG-agGOAJA8QdIBhoCbGYiIDQzNzZlYmQwOTgzNGE2OTk0Nzc4ZWIyYzcwOTRkM2Yx","domain":".douyin.com","path":"/","expires":1724590767.13678,"httpOnly":true,"secure":true,"sameSite":"Lax"},{"name":"ssid_ucp_sso_v1","value":"1.0.0-KDNjMzZkZTVlZmE5MDc0NzZmZmM0ZjhjMDNlMmNmNTdhNjcxMTgwNmEKIQjDoeChnsyCAxCuofCzBhjaFiAMMMGG-agGOAJA8QdIBhoCbGYiIDQzNzZlYmQwOTgzNGE2OTk0Nzc4ZWIyYzcwOTRkM2Yx","domain":".douyin.com","path":"/","expires":1724590767.136802,"httpOnly":true,"secure":true,"sameSite":"None"},{"name":"odin_tt","value":"ebc5b53665196b1140d2550f80fcd0b6b47d10457bf9ad75457f918f899558ce2e6b0522c1cdb0cada4a0cbef8ab3726b26f91625532b95cc2aba1d84f992287","domain":".douyin.com","path":"/","expires":1750942767.497628,"httpOnly":true,"secure":false,"sameSite":"Lax"},{"name":"passport_auth_status","value":"23f45dfbe7ffc205cc34311027dc3ddc%2C680936de65cb7200da91483f65bf8c9f","domain":".douyin.com","path":"/","expires":1721998767.497808,"httpOnly":true,"secure":false,"sameSite":"Lax"},{"name":"passport_auth_status_ss","value":"23f45dfbe7ffc205cc34311027dc3ddc%2C680936de65cb7200da91483f65bf8c9f","domain":".douyin.com","path":"/","expires":1721998767.497856,"httpOnly":true,"secure":true,"sameSite":"None"},{"name":"bd_ticket_guard_server_data","value":"eyJ0aWNrZXQiOiI2YjAwOWE1NjJhZTFhNjcxMGE0MmJhZGU5NjdmNDkxOCIsInRzX3NpZ24iOiJ0cy4xLmNjOWQzZmUxMDg0YzA1ZDRlZGMwMzU2ZDFiNDNjNTJmNjc5MDViMjc3OWE2MWRlMGUwYjYxNWVjM2YxM2IwMDZjNGZiZTg3ZDIzMTljZjA1MzE4NjI0Y2VkYTE0OTExY2E0MDZkZWRiZWJlZGRiMmUzMGZjZThkNGZhMDI1NzVkIiwiY2xpZW50X2NlcnQiOiJwdWIuQkcybGVTZmpPOWhsSWJESzAzRDBiSVdJTW5Bd21PM0gvWjhIb01oVldaZVU1VUpjc09CZU9JZlN6SklzSDNIaUJ4ZmJhWngrR1B6eXRuS3VITmFXeVhNPSJ9","domain":".douyin.com","path":"/","expires":1724590767.497897,"httpOnly":false,"secure":false,"sameSite":"Lax"},{"name":"bd_ticket_guard_web_domain","value":"2","domain":"creator.douyin.com","path":"/","expires":1724590767.497927,"httpOnly":false,"secure":false,"sameSite":"Lax"},{"name":"sid_guard","value":"6b009a562ae1a6710a42bade967f4918%7C1719406767%7C5184001%7CSun%2C+25-Aug-2024+12%3A59%3A28+GMT","domain":".douyin.com","path":"/","expires":1750510767.497953,"httpOnly":true,"secure":true,"sameSite":"Lax"},{"name":"uid_tt","value":"f3453c2cba2f2a8706f90e7383db907f","domain":".douyin.com","path":"/","expires":1724590768.497979,"httpOnly":true,"secure":true,"sameSite":"Lax"},{"name":"uid_tt_ss","value":"f3453c2cba2f2a8706f90e7383db907f","domain":".douyin.com","path":"/","expires":1724590768.498005,"httpOnly":true,"secure":true,"sameSite":"None"},{"name":"sid_tt","value":"6b009a562ae1a6710a42bade967f4918","domain":".douyin.com","path":"/","expires":1724590768.498033,"httpOnly":true,"secure":true,"sameSite":"Lax"},{"name":"sessionid","value":"6b009a562ae1a6710a42bade967f4918","domain":".douyin.com","path":"/","expires":1724590768.498057,"httpOnly":true,"secure":true,"sameSite":"Lax"},{"name":"sessionid_ss","value":"6b009a562ae1a6710a42bade967f4918","domain":".douyin.com","path":"/","expires":1724590768.498081,"httpOnly":true,"secure":true,"sameSite":"None"},{"name":"sid_ucp_v1","value":"1.0.0-KDg2NjU5OGY4OTM3YjVmYWM5M2FhNTQ3YzQ0YjdlMGVjODY5NDFhMmYKGwjDoeChnsyCAxCvofCzBhjaFiAMOAJA8QdIBBoCbGYiIDZiMDA5YTU2MmFlMWE2NzEwYTQyYmFkZTk2N2Y0OTE4","domain":".douyin.com","path":"/","expires":1724590768.498106,"httpOnly":true,"secure":true,"sameSite":"Lax"},{"name":"ssid_ucp_v1","value":"1.0.0-KDg2NjU5OGY4OTM3YjVmYWM5M2FhNTQ3YzQ0YjdlMGVjODY5NDFhMmYKGwjDoeChnsyCAxCvofCzBhjaFiAMOAJA8QdIBBoCbGYiIDZiMDA5YTU2MmFlMWE2NzEwYTQyYmFkZTk2N2Y0OTE4","domain":".douyin.com","path":"/","expires":1724590768.498136,"httpOnly":true,"secure":true,"sameSite":"None"},{"name":"x-web-secsdk-uid","value":"47913fb1-24a9-4a9b-baf4-5d17955495c6","domain":"creator.douyin.com","path":"/","expires":-1,"httpOnly":false,"secure":false,"sameSite":"Lax"},{"name":"csrf_session_id","value":"76170f38928b638b29e726544cd882dd","domain":"creator.douyin.com","path":"/","expires":-1,"httpOnly":false,"secure":true,"sameSite":"None"}],"origins":[{"origin":"https://creator.douyin.com","localStorage":[{"name":"__tea_cache_tokens_2018","value":"{\\"web_id\\":\\"7384795757884786226\\",\\"user_unique_id\\":\\"verify_lxvue7co_kVAIeQZE_YgAf_4CzN_8LHV_6spzTMIiA14d\\",\\"timestamp\\":1719406765996,\\"_type_\\":\\"default\\"}"},{"name":"__tea_cache_first_1661","value":"1"},{"name":"tt_scid","value":"MtgjOZM18Q1elRQT0Xd0cRiRgopurcRJEpIlX0-PF9EvcrO5fHn148exeBcxyYv1d08b"},{"name":"web_security_runtime_cache_https://lf-security.bytegoofy.com/obj/security-secsdk/project_40.js","value":"// "},{"name":"SLARDARdouyin_creator","value":"JTdCJTIydXNlcklkJTIyOiUyMjIyOWIwZGMwLTMyZTgtNDA4My1iNTc4LTA2NTliN2QzNGUwMSUyMiwlMjJkZXZpY2VJZCUyMjolMjI1MzcwODA3MS00ZWViLTQwZDctODA5Ni0zMTg2NzA3YWZkNjklMjIsJTIyZXhwaXJlcyUyMjoxNzI3MTgyNzY3OTk2JTdE"},{"name":"__tea_sdk_ab_version_2906","value":"{\\"data\\":{\\"assistantImage\\":{\\"val\\":1,\\"vid\\":\\"90116780\\"},\\"creator_danmaku_manage\\":{\\"val\\":{\\"menus_show\\":1},\\"vid\\":\\"90118007\\"},\\"creator_data_new\\":{\\"val\\":true,\\"vid\\":\\"90081040\\"},\\"creator_pc\\":{\\"val\\":{\\"tab_ab_show_new_home\\":1},\\"vid\\":\\"90109488\\"},\\"creator_pc_1_3_intell_chapter\\":{\\"val\\":1,\\"vid\\":\\"90122502\\"},\\"creator_pc_clip\\":{\\"val\\":{\\"capcut\\":1},\\"vid\\":\\"90119963\\"},\\"creator_pc_data_center\\":{\\"val\\":{\\"is_new_live_content\\":1},\\"vid\\":\\"90111860\\"},\\"creator_pc_game_mounted_anchor_reedit\\":{\\"val\\":1,\\"vid\\":\\"90122407\\"},\\"creator_pc_home\\":{\\"val\\":{\\"interactive_show_type\\":2},\\"vid\\":\\"90111556\\"},\\"creator_pc_mission\\":{\\"val\\":{\\"visible\\":1},\\"vid\\":\\"90112463\\"},\\"creator_pc_org_home\\":{\\"val\\":{\\"new_home\\":1},\\"vid\\":\\"90112354\\"},\\"creator_pc_tab_ab\\":{\\"val\\":{\\"account_show\\":2},\\"vid\\":\\"90092974\\"},\\"creator_publish_cover_check\\":{\\"val\\":1,\\"vid\\":\\"90122334\\"},\\"creator_school_nav\\":{\\"val\\":{\\"nav_type\\":1},\\"vid\\":\\"90081895\\"},\\"data_cover_rate\\":{\\"val\\":{\\"is_show_cover_rate\\":true},\\"vid\\":\\"90121311\\"},\\"dict\\":{\\"val\\":{\\"canShowUserDeclaration\\":true},\\"vid\\":\\"90114001\\"},\\"douyin_cover_imagelayer_editable\\":{\\"val\\":true,\\"vid\\":\\"90111484\\"},\\"douyin_outer_progress_enbale\\":{\\"val\\":1,\\"vid\\":\\"90118893\\"},\\"douyin_pc_creator_image_text\\":{\\"val\\":true,\\"vid\\":\\"90093311\\"},\\"editor_filter\\":{\\"val\\":true,\\"vid\\":\\"90122909\\"},\\"is_show_pc_content_analysis\\":{\\"val\\":{\\"enabled\\":1},\\"vid\\":\\"90118423\\"},\\"refine_cover_tool\\":{\\"val\\":2,\\"vid\\":\\"90120266\\"},\\"show_activity_tag\\":{\\"val\\":true,\\"vid\\":\\"90102355\\"},\\"show_intellect_chapter_entry\\":{\\"val\\":1,\\"vid\\":\\"90094899\\"},\\"slardar_filter\\":{\\"val\\":true,\\"vid\\":\\"90122697\\"},\\"table_tab\\":{\\"val\\":\\"contribute\\",\\"vid\\":\\"90094565\\"},\\"test\\":{\\"val\\":true,\\"vid\\":\\"90082519\\"},\\"title_permission_new\\":{\\"val\\":1,\\"vid\\":\\"90111481\\"}},\\"uuid\\":\\"7384795127434741298\\",\\"timestamp\\":1719406620970,\\"ab_version_multilink\\":[],\\"ab_ext_version\\":[],\\"ab_version\\":[]}"},{"name":"web_security_runtime_cache_https://lf-security.bytegoofy.com/obj/security-secsdk/strategy_40.js","value":"// "},{"name":"security-sdk/s_sdk_cert_key","value":"{\\"data\\":\\"pub.BG2leSfjO9hlIbDK03D0bIWIMnAwmO3H/Z8HoMhVWZeU5UJcsOBeOIfSzJIsH3HiBxfbaZx+GPzytnKuHNaWyXM=\\"}"},{"name":"xmstr","value":"{\\"sTm\\":1719406621913,\\"acc\\":1100}"},{"name":"xmst","value":"ksH8DlAXGYvfzIwlkgLchLMWqIGW-km_6SiEgmGXI6SudMt6QKglPe_362XQEwYjDCCilPM1mliVZ20lhY43Q0XzutOXLejBXhTUh4uVvQguue1sRRQenaDGgZRD"},{"name":"security-sdk/s_sdk_sign_data_key/sso","value":"{\\"data\\":\\"{\\\\\\"ticket\\\\\\":\\\\\\"4376ebd09834a6994778eb2c7094d3f1\\\\\\",\\\\\\"ts_sign\\\\\\":\\\\\\"ts.1.c7060e3a615c100b925a37a76f8917e166de6221146173b542b8dcbf7d3ef591c4fbe87d2319cf05318624ceda14911ca406dedbebeddb2e30fce8d4fa02575d\\\\\\",\\\\\\"client_cert\\\\\\":\\\\\\"pub.BG2leSfjO9hlIbDK03D0bIWIMnAwmO3H/Z8HoMhVWZeU5UJcsOBeOIfSzJIsH3HiBxfbaZx+GPzytnKuHNaWyXM=\\\\\\"}\\"}"},{"name":"ttcid","value":"6b4834cf267f4c399ca0085a3ed4d15330"},{"name":"web_runtime_security_uid","value":"47913fb1-24a9-4a9b-baf4-5d17955495c6"},{"name":"X_STORAGE_FALLBACK_VERSION","value":"4.0.3"},{"name":"CREATOR_LAYOUT_CONFIG","value":"{\\"headerLogo\\":{\\"douyin\\":{\\"src\\":\\"//lf3-static.bytednsdoc.com/obj/eden-cn/lm-yvahlyj-upfbvk/ljhwZthlaukjlkulzlp/pc/icons/logo.png\\"},\\"huoshan\\":{\\"src\\":\\"//p3.douyinpic.com/aweme-server-static-resource/ies_douyin_opencn_tiktok_creator_header_logo_h.png~tplv-obj.image\\"}},\\"hotsoonHelpShow\\":false,\\"footerLink\\":[{\\"children\\":\\"账号授权协议\\",\\"href\\":\\"//lf3-beecdn.bytetos.com/obj/ies-fe-bee/bee_prod/biz_181/bee_prod_181_bee_publish_1095.html\\"},{\\"children\\":\\"用户服务协议\\",\\"href\\":\\" //www.douyin.com/agreement/\\"},{\\"children\\":\\"隐私政策\\",\\"href\\":\\" //www.douyin.com/privacy/\\"},{\\"children\\":\\"账号找回\\",\\"href\\":\\" //www.douyin.com/recovery_account/\\"},{\\"children\\":\\"联系我们\\",\\"href\\":\\" //www.douyin.com/aboutus/\\"}],\\"footerText\\":[[\\"2024 © 抖音\\",\\"京ICP备16016397号-3\\",\\"北京抖音科技有限公司\\"],[\\"[中国互联网举报中心](http://www.12377.cn/)\\",\\"网络文化许可证-京网文-（2016）2282-264号\\",\\"违法和不良信息举报：400-140-2108\\",\\"举报邮箱：feedback@douyin.com\\"],[\\"![pic](//p3.douyinpic.com/aweme-server-static-resource/gongan_d0289dc.png~tplv-obj.image)\\",\\"[京公网安备11000002002046号](http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=11000002002046)\\",\\"地址: 北京市海淀区知春路51号4层408\\"]],\\"permissionKeys\\":[{\\"itemKey\\":\\"/authority\\",\\"text\\":\\"授权管理\\",\\"show\\":true,\\"permission\\":\\"CreatorConferManage\\"},{\\"itemKey\\":\\"/content/\\",\\"text\\":\\"内容管理\\",\\"path\\":[\\"/live/media/create\\",\\"/live/media/room\\",\\"/live/media/list\\"],\\"show\\":true,\\"permission\\":\\"CreatorContentManage\\"},{\\"itemKey\\":\\"/following\\",\\"text\\":\\"互动管理\\",\\"show\\":true,\\"permission\\":\\"CreatorInterManage\\"},{\\"itemKey\\":\\"/data\\",\\"text\\":\\"数据管理\\",\\"path\\":[\\"/live/media/data\\"],\\"show\\":true,\\"permission\\":\\"CreatorDataManage\\"},{\\"itemKey\\":\\"/musician\\",\\"text\\":\\"音乐管理\\",\\"show\\":true,\\"restrictHotsoon\\":true,\\"permission\\":\\"CreatorMusicManage\\"},{\\"itemKey\\":\\"/publicity/topic\\",\\"text\\":\\"宣发管理\\",\\"show\\":false,\\"restrictHotsoon\\":true,\\"permission\\":\\"CreatorContentManage.Challenge\\"}],\\"headerIcons\\":[{\\"src\\":\\"//p3.douyinpic.com/aweme-server-static-resource/ies_douyin_opencn_tiktok_creator_header_notification_icon.svg~tplv-obj.image\\",\\"link\\":\\"https://creator.douyin.com/message\\",\\"visible\\":{\\"has_unread_message\\":false,\\"is_login_hotsoon\\":false}},{\\"src\\":\\"//p3.douyinpic.com/aweme-server-static-resource/ies_douyin_opencn_tiktok_creator_header_notification.png~tplv-obj.image\\",\\"link\\":\\"https://creator.douyin.com/message\\",\\"style\\":{\\"width\\":\\"24px\\",\\"height\\":\\"24px\\"},\\"badge\\":{\\"count\\":\\"unread_message_count\\"},\\"visible\\":{\\"has_unread_message\\":true,\\"is_login_hotsoon\\":false}}],\\"sidebarFollowerTip\\":\\"仅展示抖音粉丝\\",\\"sidebarData\\":{\\"data\\":[{\\"name\\":\\"视频数据\\",\\"keyName\\":\\"CreatorDataManage\\",\\"icon\\":\\"//p3.douyinpic.com/aweme-server-static-resource/ies_douyin_opencn_tiktok_creator_sidebar_vedio.svg~tplv-obj.image\\",\\"auth\\":true,\\"children\\":[{\\"path\\":\\"/data/stats/overview\\",\\"name\\":\\"数据总览\\",\\"keyName\\":\\"CreatorDataManage.UserOverview\\",\\"visible\\":{\\"is_login_hotsoon\\":false}},{\\"path\\":\\"/data/stats/video\\",\\"name\\":\\"作品数据\\",\\"keyName\\":\\"CreatorDataManage.ItemL2\\",\\"visible\\":{\\"is_login_hotsoon\\":false}},{\\"path\\":\\"/data/stats/follower/portrait\\",\\"name\\":\\"粉丝画像\\",\\"keyName\\":\\"CreatorDataManage.Portrait\\",\\"visible\\":{\\"is_login_hotsoon\\":false}},{\\"path\\":\\"/data/stats/hotsoon-overview\\",\\"name\\":\\"数据总览\\",\\"keyName\\":\\"CreatorDataManage.UserOverview\\",\\"visible\\":{\\"is_login_hotsoon\\":true}},{\\"path\\":\\"/data/stats/hotsoon-item\\",\\"name\\":\\"作品数据\\",\\"keyName\\":\\"CreatorDataManage.ItemL2\\",\\"visible\\":{\\"is_login_hotsoon\\":true}},{\\"path\\":\\"/weekly\\",\\"name\\":\\"创作周报\\",\\"keyName\\":\\"CreatorDataManage.WeekReport\\",\\"visible\\":{\\"is_login_hotsoon\\":false}}]},{\\"name\\":\\"直播数据\\",\\"icon\\":\\"//p3.douyinpic.com/aweme-server-static-resource/ies_douyin_opencn_tiktok_creator_sidebar_data_icon.svg~tplv-obj.image\\",\\"auth\\":true,\\"children\\":[{\\"path\\":\\"/data/live/overview\\",\\"name\\":\\"数据总览\\",\\"key\\":\\"CreatorDataManage.Live\\"},{\\"path\\":\\"/live/media/data\\",\\"name\\":\\"数据总览\\",\\"key\\":\\"CreatorLiveManage.Data\\"},{\\"path\\":\\"/data/live/video\\",\\"name\\":\\"单场数据\\",\\"key\\":\\"CreatorDataManage.Live\\"}]},{\\"name\\":\\"重点关注\\",\\"keyName\\":\\"CreatorDataManage\\",\\"auth\\":true,\\"icon\\":\\"//p3.douyinpic.com/aweme-server-static-resource/ies_douyin_opencn_tiktok_creator_sidebar_inportant.svg~tplv-obj.image\\",\\"visible\\":[{\\"status_code\\":8,\\"window.location.host\\":\\"creator.douyin.com\\"},{\\"status_code\\":15384,\\"window.location.host\\":\\"creator.douyin.com\\"},{\\"is_login_hotsoon\\":false}],\\"children\\":[{\\"path\\":\\"/data/important/following\\",\\"name\\":\\"我关心的\\",\\"keyName\\":\\"CreatorDataManage.TraceOthers\\"},{\\"path\\":\\"/data/important/keyword\\",\\"name\\":\\"与我相关\\",\\"keyName\\":\\"CreatorDataManage.SearchSelf\\"}]}],\\"interaction\\":[{\\"name\\":\\"互动管理\\",\\"keyName\\":\\"CreatorInterManage\\",\\"icon\\":\\"//p3.douyinpic.com/aweme-server-static-resource/ies_douyin_opencn_tiktok_creator_sidebar_following.svg~tplv-obj.image\\",\\"auth\\":true,\\"children\\":[{\\"path\\":\\"/following/following\\",\\"name\\":\\"关注管理\\"},{\\"path\\":\\"/following/follower\\",\\"name\\":\\"粉丝管理\\"},{\\"path\\":\\"/following/comment\\",\\"name\\":\\"评论管理\\",\\"visible\\":{\\"is_login_hotsoon\\":false}},{\\"path\\":\\"/following/chat\\",\\"name\\":\\"私信管理\\",\\"key\\":\\"CreatorInterManage.im\\",\\"keyName\\":\\"CreatorInterManage.im\\",\\"visible\\":{\\"is_login_hotsoon\\":false,\\"douyin_user_verify_info.teen_model\\":false}}]}],\\"publicity\\":[{\\"name\\":\\"宣发管理\\",\\"key\\":\\"CreatorContentManage.Challenge\\",\\"icon\\":\\"//p3.douyinpic.com/aweme-server-static-resource/ies_douyin_opencn_tiktok_creator_sidebar_publicity.svg~tplv-obj.image\\",\\"children\\":[{\\"path\\":\\"/publicity/topic\\",\\"name\\":\\"话题管理\\"}]}],\\"music\\":[{\\"name\\":\\"音乐管理\\",\\"key\\":\\"CreatorMusicManage\\",\\"icon\\":\\"//p3.douyinpic.com/aweme-server-static-resource/ies_douyin_opencn_tiktok_creator_sidebar_music.svg~tplv-obj.image\\",\\"children\\":[{\\"path\\":\\"/musician\\",\\"name\\":\\"概览\\"},{\\"path\\":\\"/musician/songs\\",\\"name\\":\\"音乐管理\\"},{\\"path\\":\\"/musician/statistics\\",\\"name\\":\\"数据管理\\"}]}],\\"live\\":[{\\"name\\":\\"直播管理\\",\\"key\\":\\"CreatorLiveManage\\",\\"children\\":[{\\"path\\":\\"/live/media/create\\",\\"name\\":\\"创建直播\\",\\"icon\\":\\"//p3.douyinpic.com/aweme-server-static-resource/ttfe_open_creator_sidebar_livecreate.svg~tplv-obj.image\\",\\"key\\":\\"CreatorLiveManage.Create\\"},{\\"path\\":\\"/live/media/list\\",\\"name\\":\\"直播列表\\",\\"icon\\":\\"//p3.douyinpic.com/aweme-server-static-resource/ttfe_open_creator_sidebar_livelist.svg~tplv-obj.image\\",\\"key\\":\\"CreatorLiveManage.List\\"},{\\"path\\":\\"/live/media/replay\\",\\"name\\":\\"直播回放\\",\\"icon\\":\\"//p3.douyinpic.com/aweme-server-static-resource/ttfe_open_creator_sidebar_livereplay.svg~tplv-obj.image\\",\\"key\\":\\"CreatorLiveManage.Replay\\"}]},{\\"name\\":\\"数据管理\\",\\"key\\":\\"CreatorLiveManage.Data\\",\\"icon\\":\\"//p3.douyinpic.com/aweme-server-static-resource/ttfe_open_creator_sidebar_livedata.svg~tplv-obj.image\\",\\"children\\":[{\\"path\\":\\"/live/media/data\\",\\"name\\":\\"直播数据\\",\\"icon\\":\\"//p3.douyinpic.com/aweme-server-static-resource/ttfe_open_creator_sidebar_livedata.svg~tplv-obj.image\\",\\"key\\":\\"CreatorLiveManage.Data\\"}]}],\\"media\\":[{\\"name\\":\\"发布视频\\",\\"icon\\":\\"//p3.douyinpic.com/aweme-server-static-resource/ies_douyin_opencn_tiktok_creator_sidebar_upload_v2.svg~tplv-obj.image\\",\\"path\\":[\\"/content/upload\\",\\"/content/publish\\"]},{\\"name\\":\\"内容管理\\",\\"icon\\":\\"//p3.douyinpic.com/aweme-server-static-resource/ies_douyin_opencn_tiktok_creator_sidebar_manage_v2.svg~tplv-obj.image\\",\\"children\\":[{\\"path\\":\\"/content/manage\\",\\"name\\":\\"视频管理\\",\\"icon\\":\\"\\"},{\\"path\\":[\\"/content/collection/manage\\",\\"/content/collection/detail\\",\\"/content/collection/create\\"],\\"name\\":\\"合集管理\\",\\"icon\\":\\"\\",\\"visContextKey\\":\\"userInfo.mix_permission\\",\\"visContextValue\\":true},{\\"path\\":\\"/content/safeguard\\",\\"name\\":\\"维权管理\\",\\"icon\\":\\"\\",\\"visContextKey\\":\\"userInfo.permission.user_sign\\",\\"visContextValue\\":true}]},{\\"name\\":\\"直播管理\\",\\"icon\\":\\"//p3.douyinpic.com/aweme-server-static-resource/ies_douyin_opencn_tiktok_creator_sidebar_livecreate_v2.svg~tplv-obj.image\\",\\"visContextKey\\":\\"creatorMenu.live_manage\\",\\"visContextValue\\":true,\\"children\\":[{\\"path\\":\\"/live/media/create\\",\\"name\\":\\"创建直播\\",\\"icon\\":\\"\\",\\"key\\":\\"CreatorLiveManage.Create\\",\\"visContextKey\\":\\"creatorMenu.media_auth\\",\\"visContextValue\\":true},{\\"path\\":\\"/live/media/list\\",\\"name\\":\\"直播列表\\",\\"icon\\":\\"\\",\\"key\\":\\"CreatorLiveManage.List\\",\\"visContextKey\\":\\"creatorMenu.media_auth\\",\\"visContextValue\\":true},{\\"path\\":\\"/content/live/replay\\",\\"name\\":\\"直播回放\\",\\"icon\\":\\"\\",\\"key\\":\\"CreatorLiveManage.Replay\\",\\"visContextKey\\":\\"creatorMenu.replay_auth\\",\\"visContextValue\\":true},{\\"path\\":\\"/content/live/replay\\",\\"name\\":\\"直播回放\\",\\"key\\":\\"CreatorCommonManage.Replay\\"}]}]}}"},{"name":"security-sdk/s_sdk_crypt_sdk","value":"{\\"data\\":\\"{\\\\\\"ec_privateKey\\\\\\":\\\\\\"-----BEGIN PRIVATE KEY-----\\\\\\\\r\\\\\\\\nMIGHAgEAMBMGByqGSM49AgEGCCqGSM49AwEHBG0wawIBAQQg6B5HwApeTlN891od\\\\\\\\r\\\\\\\\ngU66WcupD+QIic9gszZUSgbN6VyhRANCAARtpXkn4zvYZSGwytNw9GyFiDJwMJjt\\\\\\\\r\\\\\\\\nx/2fB6DIVVmXlOVCXLDgXjiH0sySLB9x4gcX22mcfhj88rZyrhzWlslz\\\\\\\\r\\\\\\\\n-----END PRIVATE KEY-----\\\\\\\\r\\\\\\\\n\\\\\\",\\\\\\"ec_publicKey\\\\\\":\\\\\\"-----BEGIN PUBLIC KEY-----\\\\\\\\r\\\\\\\\nMFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAEbaV5J+M72GUhsMrTcPRshYgycDCY\\\\\\\\r\\\\\\\\n7cf9nwegyFVZl5TlQlyw4F44h9LMkiwfceIHF9tpnH4Y/PK2cq4c1pbJcw==\\\\\\\\r\\\\\\\\n-----END PUBLIC KEY-----\\\\\\\\r\\\\\\\\n\\\\\\",\\\\\\"ec_csr\\\\\\":\\\\\\"-----BEGIN CERTIFICATE REQUEST-----\\\\\\\\r\\\\\\\\nMIIBEzCBuQIBADAnMQswCQYDVQQGEwJDTjEYMBYGA1UEAwwPYmRfdGlja2V0X2d1\\\\\\\\r\\\\\\\\nYXJkMFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAEbaV5J+M72GUhsMrTcPRshYgy\\\\\\\\r\\\\\\\\ncDCY7cf9nwegyFVZl5TlQlyw4F44h9LMkiwfceIHF9tpnH4Y/PK2cq4c1pbJc6Aw\\\\\\\\r\\\\\\\\nMC4GCSqGSIb3DQEJDjEhMB8wHQYDVR0RBBYwFIISY3JlYXRvci5kb3V5aW4uY29t\\\\\\\\r\\\\\\\\nMAoGCCqGSM49BAMCA0kAMEYCIQDyOKf2uso9gpYMCURZv95PC0v0XOwdeJ7uDHFg\\\\\\\\r\\\\\\\\nkVobnwIhAMbV6GlqKqpQssY/k59tM4uIqUHVmgV6GFGwEt1Tv5Zd\\\\\\\\r\\\\\\\\n-----END CERTIFICATE REQUEST-----\\\\\\\\r\\\\\\\\n\\\\\\"}\\"}"},{"name":"LOGIN_STATUS","value":"{}"},{"name":"msToken","value":"ksH8DlAXGYvfzIwlkgLchLMWqIGW-km_6SiEgmGXI6SudMt6QKglPe_362XQEwYjDCCilPM1mliVZ20lhY43Q0XzutOXLejBXhTUh4uVvQguue1sRRQenaDGgZRD"},{"name":"__tea_cache_tokens_1661","value":"{\\"web_id\\":\\"7384795692382701094\\",\\"user_unique_id\\":\\"7384795692382701094\\",\\"timestamp\\":1719406751145,\\"_type_\\":\\"default\\"}"},{"name":"__tea_cache_tokens_2906","value":"{\\"web_id\\":\\"7384795127434741298\\",\\"user_unique_id\\":\\"7384795127434741298\\",\\"timestamp\\":1719406620504,\\"_type_\\":\\"default\\"}"},{"name":"xmsi","value":"1"},{"name":"__tea_cache_first_2018","value":"1"},{"name":"SLARDARmfa_web","value":"JTdCJTIydXNlcklkJTIyOiUyMmIyNmQ4NzhkLTkxOWYtNGJiYi1hMmVkLTMyODcyNTY5NTdhZSUyMiwlMjJkZXZpY2VJZCUyMjolMjI4NzRiZjJlYS1mYmU1LTQ2YjktYTM4My03OWUyNTAxMTQ3ZjMlMjIsJTIyZXhwaXJlcyUyMjoxNzI3MTgyNzUxNDUzJTdE"},{"name":"SLARDARuc_secure_sdk","value":"JTdCJTIydXNlcklkJTIyOiUyMmFlNzM0YjkwLWZjMGQtNGJkMC1hMDQ4LWU3MzBkN2I4ZGM4YiUyMiwlMjJkZXZpY2VJZCUyMjolMjI4NjgzN2I3OC0wNGY2LTRmZjEtYmFjMC1lODk0N2QzN2RlZGIlMjIsJTIyZXhwaXJlcyUyMjoxNzI3MTgyNjIxMjA4JTdE"},{"name":"__tea_cache_first_2906","value":"1"}]},{"origin":"https://lf-zt.douyin.com","localStorage":[{"name":"security-sdk/s_sdk_sign_data_key/sso","value":"{\\"data\\":\\"{\\\\\\"ticket\\\\\\":\\\\\\"4376ebd09834a6994778eb2c7094d3f1\\\\\\",\\\\\\"ts_sign\\\\\\":\\\\\\"ts.1.c7060e3a615c100b925a37a76f8917e166de6221146173b542b8dcbf7d3ef591c4fbe87d2319cf05318624ceda14911ca406dedbebeddb2e30fce8d4fa02575d\\\\\\",\\\\\\"client_cert\\\\\\":\\\\\\"pub.BG2leSfjO9hlIbDK03D0bIWIMnAwmO3H/Z8HoMhVWZeU5UJcsOBeOIfSzJIsH3HiBxfbaZx+GPzytnKuHNaWyXM=\\\\\\"}\\"}"},{"name":"security-sdk/s_sdk_cert_key","value":"{\\"data\\":\\"pub.BG2leSfjO9hlIbDK03D0bIWIMnAwmO3H/Z8HoMhVWZeU5UJcsOBeOIfSzJIsH3HiBxfbaZx+GPzytnKuHNaWyXM=\\"}"},{"name":"security-sdk/s_sdk_crypt_sdk","value":"{\\"data\\":\\"{\\\\\\"ec_privateKey\\\\\\":\\\\\\"-----BEGIN PRIVATE KEY-----\\\\\\\\r\\\\\\\\nMIGHAgEAMBMGByqGSM49AgEGCCqGSM49AwEHBG0wawIBAQQg6B5HwApeTlN891od\\\\\\\\r\\\\\\\\ngU66WcupD+QIic9gszZUSgbN6VyhRANCAARtpXkn4zvYZSGwytNw9GyFiDJwMJjt\\\\\\\\r\\\\\\\\nx/2fB6DIVVmXlOVCXLDgXjiH0sySLB9x4gcX22mcfhj88rZyrhzWlslz\\\\\\\\r\\\\\\\\n-----END PRIVATE KEY-----\\\\\\\\r\\\\\\\\n\\\\\\",\\\\\\"ec_publicKey\\\\\\":\\\\\\"-----BEGIN PUBLIC KEY-----\\\\\\\\r\\\\\\\\nMFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAEbaV5J+M72GUhsMrTcPRshYgycDCY\\\\\\\\r\\\\\\\\n7cf9nwegyFVZl5TlQlyw4F44h9LMkiwfceIHF9tpnH4Y/PK2cq4c1pbJcw==\\\\\\\\r\\\\\\\\n-----END PUBLIC KEY-----\\\\\\\\r\\\\\\\\n\\\\\\",\\\\\\"ec_csr\\\\\\":\\\\\\"-----BEGIN CERTIFICATE REQUEST-----\\\\\\\\r\\\\\\\\nMIIBEzCBuQIBADAnMQswCQYDVQQGEwJDTjEYMBYGA1UEAwwPYmRfdGlja2V0X2d1\\\\\\\\r\\\\\\\\nYXJkMFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAEbaV5J+M72GUhsMrTcPRshYgy\\\\\\\\r\\\\\\\\ncDCY7cf9nwegyFVZl5TlQlyw4F44h9LMkiwfceIHF9tpnH4Y/PK2cq4c1pbJc6Aw\\\\\\\\r\\\\\\\\nMC4GCSqGSIb3DQEJDjEhMB8wHQYDVR0RBBYwFIISY3JlYXRvci5kb3V5aW4uY29t\\\\\\\\r\\\\\\\\nMAoGCCqGSM49BAMCA0kAMEYCIQDyOKf2uso9gpYMCURZv95PC0v0XOwdeJ7uDHFg\\\\\\\\r\\\\\\\\nkVobnwIhAMbV6GlqKqpQssY/k59tM4uIqUHVmgV6GFGwEt1Tv5Zd\\\\\\\\r\\\\\\\\n-----END CERTIFICATE REQUEST-----\\\\\\\\r\\\\\\\\n\\\\\\"}\\"}"}]}]}',
    name: '雨的back',
    accountId: '10003622679',
    fans: 0,
  };
  // {
  //   storageState: 'cookies',
  //   name: '雨的',
  //   accountId: '68143622679',
  //   fans: 0,
  // };

  /**
   * 打开登录页面并等待用户完成登录
   */
  const open = async () => {
    browser = await chromium.launch({
      headless: false,
      channel: 'msedge',
    });
    context = await browser.newContext(devices['Desktop Edge']);
    page = await context.newPage();
    await page.goto(config.loginUrl);
    await page.waitForURL(config.waitForUrl, { timeout: 0, waitUntil: 'domcontentloaded' });

    return true;
  };

  const exec = async () => {
    // try {
    //   await open();
    //   userInfo.storageState = JSON.stringify(await context.storageState());
    // } catch (err) {
    //   console.error('获取storageState登录状态失败', err);
    // } finally {
    //   browser?.close();
    // }

    // 获取用户信息122344
    return userInfo;
  };
  return {
    open,
    exec,
  };
}
